# Generated by cynkrathis::use_gitpod(), do not edit by hand
#
# Call:
# quote(cynkrathis::use_gitpod())

tasks:
  - name: dependencies
    init: |
      # Set up rig
      curl -Ls https://github.com/r-lib/rig/releases/download/latest/rig-linux-latest.tar.gz | sudo tar xz -C /usr/local

      # Set up R
      rig install
      rig system add-pak
      rig system make-links
      rig system setup-user-lib

      # Deps
      sudo apt install -y ccache cmake

      # Scriptlets, with custom Git config
      mv ~/.gitconfig ~/.gitconfig.gitpod
      curl -s https://raw.githubusercontent.com/krlmlr/scriptlets/master/bootstrap | sh

      # .editorconfig
      ln -s ~/.editorconfig ..

      # Set up ccache
      ln -s /usr/lib/ccache/* ~/bin/

      # Set up Makevars
      mkdir -p ~/.R
      echo -e "MAKEFLAGS = -j8\nCXXFLAGS = -O0 -g" > ~/.R/Makevars

      ## Work around glitch with non-systemd systems
      ln -s $(which true) ~/bin/timedatectl

      # Install R packages
      echo 'options(repos = "https://packagemanager.rstudio.com/all/__linux__/'$(cat /etc/lsb-release | sed  -n '/DISTRIB_CODENAME=/ {s///;p}')'/latest")' >> ~/.Rprofile

      ## Install devtools and R dependencies
      R -q -e 'pak::pak(c("devtools", "languageserver", "styler")); pak::pak("deps::.", dependencies = TRUE)'

vscode:
  extensions:
    - ms-vscode.cpptools-extension-pack
    - go2sh.cmake-integration-vscode
    - EditorConfig.EditorConfig
    - REditorSupport.r
